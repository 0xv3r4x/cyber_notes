# MAL: Malware Introductory

Important to consider:
- **P**oint **o**f **E**ntry (**PoE**):
	- Did the email filtering miss it and the user has opened the attachment?
- **I**ndicators **o**f **C**ompromise (**IoC**)
	- Has it been executed on the machine?
	- Are there files or processes, or any attempt at communiction?
- **Behaviour**:
	- How does the malware perform?
	- Does it attempt to infect other devices?
	- Does it encrypt files or install additional files, e.g., backdoor or Remote Access Tool (RAT)
- **Future Risk**:
	- Can we prevent and/or detect further infection

Two types of campaigns:
- **Targeted**:
	- Designed for a specific taget (e.g., Stuxnet)
- **Mass Campaign**:
	- Infect as many devices as possible and perform intended objective, regardless of target
	- May be targeted to a specific industry, but has a larger scope than targeted malware

Malware leaves an extensive trail of evidence, often in the form of network traffic (communication with hosts) and filesystem interaction (read/writes and modifications).

Process of attack:
1. **Delivery**
	- USB (e.g. Stuxnet)
	- PDF attachments (phishing campaigns)
	- Vulnerability enumeration
2. **Execution**
	- Main way malware is classified
		- Can only be understood through sample analysis
	- Encrypts files: *ransomware*
	- Records information: *spyware*
3. **Maintaining persistence (not always)**
	- Important for APTs to maintain presence within a system or network until objective is complete
4. **Persistence**
	- Reason why malware is so **noisy**
	- Ensures malware stays on the system after execution - even after the system shuts down
5. **Propagation (not always)**
	- If one device becomes infected, can it infect another device?
	- Can also produce a lot of data, especially over a network (e.g., host discovery)

**Signatures/Fingerprints**:
- **Host-based**:
	- Results of execution and any persistence performed by the malware
	- E.g., encrypted files, additional modules
- **Network-based**:
	- Network communication between other hosts and services within the network
	- For ransomware, what is the ransom payment process?

Two analysis categories:
1. **Static analysis**
	- Used to gain high-level abstraction of sample
	- Analyses state of sample without executing code
	- Techniques: **signature analysis via checksums**
2. **Dynamic analysis**
	- Involves executing the sample (typically in a sandbox environment) and observing what happens

**MD5 Checksums**:
- Cryptographic fingerprints of the malware
- Allows uniformed identificiation
- Can be found through the filesystem
- Can check if they are malicious through [VirusTotal](https://www.virustotal.com/gui/home/search)

Identifying executables:
- Hex value: `4D 5A`
- More [file signatures](https://www.garykessler.net/library/file_sigs.html)
- [PeID](https://www.aldeid.com/wiki/PEiD) can identify the packet of a file (i.e., what compiler was used to create the file)
	- Not able to deobfuscate
- Packing: form of obfuscation used to prevent analysis/decompiling of programs
	- Legit reason: protection of IP
	- Malicious reason: prevent people reversing it to understand behaviour

**Strings**:
- Program that reveals the ASCII/text contents of a file/program

**Disassemblers**: reverse the compiled code from machine code to human-readable instructions (assembly)
**Debuggers**: facilitate the execution of the program, allowing the analyst to view changes made through each step of the program
**Breakpoints**: can be introduced before certain stages of the program to prevent it being executed (e.g., right before a file encryption stage)

-----

## Task 1 - What is the Purpose of Malware Analysis?

1. Ah, now I kinda understand...

```
No answer needed
```

## Task 2 - Understanding Malware Campaigns

1. What is the famous example of targeted attack-esque malware that targeted Iran?

```
Stuxnet
```

2. What is the name of the ransomware that used the EternalBlue exploit in a mass campaign attack?

```
WannaCry
```

### Task 3 - Identifying if a Malware Attack has Happened

1. Name the first essential step of a malware attack

```
Delivery
```

2. Now name the second essential step of a malware attack

```
Execution
```

3. What type of signature is used to classify remnants of infection on a host?

```
Host-based signature
```

4. What is the name of the other classification of signature used after a malware attack?

```
Network-based signature
```

## Task 4 - Static vs. Dynamic Analysis

1. I understand the two broad categories employed when analysing potential malware!

```
No answer needed
```

## Task 5 - Discussion of Provided Tools and Their Uses

1. Let's proceed

```
No answer needed
```

## Task 6 - Connecting to the Windows Analysis Environment (Deploy)

1. I've logged in!

```
No answer needed
```

## Task 7 - Obtaining MD5 Checksums of Provided Files

1. The MD5 checksum of `aws.exe`

```
D2778164EF643BA8F44CC202EC7EF157
```

2. The MD5 checksum of `NetLogo.exe`

```
59CB421172A89E1E16C11A428326952C
```

3. The MD5 checksum of `vlc.exe`

```
5416BE1B8B04B1681CB39CF0E2CAAD9F
```

## Task 8 - Now lets see if the MD5 checksums have been analysed before

1. Does VirusTotal report this MD5 checksum/file `aws.exe` as malicious (Yay/Nay)

```
Nay
```

2. Does VirusTotal report this MD5 checksum/file `NetLogo.exe` as malicious (Yay/Nay)

```
Nay
```

3. Does VirusTotal report this MD5 checksum/file `vlc.exe` as malicious (Yay/Nay)

```
Nay
```

## Task 9 - Identifying if the Executables are obfuscated/packed

1. What does PeID propose `1DE9176AD682FF.dll` is packed with?

![[Pasted image 20220811231926.png]]

```
Microsoft Visual C++ 6.0 DLL
```

2. What does PeID propose `AD29AA1B.bin` is packed with?

![[Pasted image 20220811232051.png]]

```
Microsoft Visual C++ 6.0
```

## Task 10 - What is Obfuscation/Packing?

1. What packer does PeID report file `6F431F46547DB2628` to be packed with?

```
FSG 1.0 -> dulek/xt
```

## Task 11 - Visualising the Differences Between Packed and Non-Packed Code

1. Cursed obfuscation!

```
No answer needed
```

## Task 12 - Introduction to Strings

1. What is the URL that is outputted after using `strings`?

```
practicalmalwareanalysis.com
```

2. How many **unique** imports are there?

```
5
```

## Task 13 - Introduction to Imports

1. How many references to the `msi` in the **Imports** tab of IDA Freeware for `install.exe`

```
9
```

## Task 14 - Practical Summary

1. What is the MD5 checksum of the file?

```
F5BD8E6DC6782ED4DFA62B8215BDC429
```

2. Does VirusTotal report this file as malicious?

```
Yay
```

3. What is the last string outputted (`strings`)?

```
d:h:
```

4. What is the output of PeID when trying to detect what packer is used by the file?

```
Nothing found
```